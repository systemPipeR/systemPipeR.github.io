---
title: "SPR workflow template"
author: "my name"
date: "Last update: `r format(Sys.time(), '%d %B, %Y')`"
output: 
  html_document:
    number_sections: false
    theme: flatly
    toc: true
    toc_float:
      collapsed: true
      smooth_scroll: false
package: systemPipeR
fontsize: 14pt
---

# About this template 

This is a workflow template.

# Workflow Steps

## step1 export_iris
```{r export_iris, eval=FALSE, spr='r', spr.dep=''}
mapply(function(x, y) write.csv(x, y), split(iris, factor(iris$Species)), file.path("results", paste0(names(split(iris, factor(iris$Species))), ".csv")))
run_session=rsession
```


## step2 gzip
```{r gzip, eval=FALSE, spr='sysargs', spr.dep='export_iris'}
appendStep(sal) <- SYSargsList(
    targets = "home/runner/work/systemPipeR/systemPipeR/inst/extdata/cwl/gunzip/targets_gunzip.txt",
    dir_path="/home/runner/work/systemPipeR/systemPipeR/inst/extdata/cwl",
    wf_file="gunzip/workflow_gzip.cwl",
    input_file="gunzip/gzip.yml",
    inputvars = c( FileName="_FILE_PATH_", SampleName="_SampleName_" ),
    dir=TRUE
)
```


## step3 gunzip
```{r gunzip, eval=FALSE, spr='sysargs', spr.dep='gzip'}
appendStep(sal) <- SYSargsList(
    targets = c("gzip"),
    dir_path="/home/runner/work/systemPipeR/systemPipeR/inst/extdata/cwl",
    wf_file="gunzip/workflow_gunzip.cwl",
    input_file="gunzip/gunzip.yml",
    inputvars = c( gzip_file="_FILE_PATH_", SampleName="_SampleName_" ),
c(" FileName "),
    dir=TRUE
)
```


## step4 stats
```{r stats, eval=FALSE, spr='r', spr.dep='gunzip'}
df <- lapply(getColumn(sal, step = "gunzip", "outfiles"), function(x) read.delim(x, sep = ",")[-1])
df <- do.call(rbind, df)
stats <- data.frame(cbind(mean = apply(df[, 1:4], 2, mean), sd = apply(df[, 1:4], 2, sd)))
stats$species <- rownames(stats)
plot <- ggplot2::ggplot(stats, ggplot2::aes(x = species, y = mean, fill = species)) + ggplot2::geom_bar(stat = "identity", color = "black", position = ggplot2::position_dodge()) + ggplot2::geom_errorbar(ggplot2::aes(ymin = mean - sd, ymax = mean + sd), width = 0.2, position = ggplot2::position_dodge(0.9))
run_session=rsession
```


